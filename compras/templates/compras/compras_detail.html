{% extends 'base.html' %}
{% block title %}Detalle de Compra{% endblock %}

{% block content %}
<h2 class="mb-3">Detalle de compra</h2>

<div class="card mb-4">
  <div class="card-body">
    <div class="row">
      <div class="col-md-6">
        <p><strong>Proveedor:</strong> {{ compra.proveedor }}</p>
        <p><strong>No. Factura:</strong> {{ compra.numero_factura }}</p>
        <p><strong>Fecha:</strong> {{ compra.fecha|date:"d/m/Y" }}</p>
      </div>
      <div class="col-md-6">
        <p><strong>Encargado:</strong> {{ compra.encargado|default:"(sin asignar)" }}</p>
        {% if compra.observaciones %}
          <p><strong>Observaciones:</strong> {{ compra.observaciones }}</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<h4>Productos comprados</h4>

<div class="table-responsive">
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th>Producto</th>
        <th class="text-end">Cantidad</th>
        <th class="text-end">Costo unitario (Q)</th>
        <th class="text-end">Subtotal (Q)</th>
      </tr>
    </thead>
    <tbody>
      {% for d in detalles %}
      <tr>
        <td>{{ d.producto }}</td>
        <td class="text-end">{{ d.cantidad|floatformat:2 }}</td>
        <td class="text-end">{{ d.costo_unitario|floatformat:2 }}</td>
        <td class="text-end">{{ d.subtotal|floatformat:2 }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4" class="text-center text-muted">No hay productos registrados en esta compra.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Total general alineado a la derecha -->
<div class="text-end mt-3">
  <h5><strong>Total de la compra:</strong> Q {{ compra.total|floatformat:2 }}</h5>
</div>

<div class="mt-4">
  <a href="{% url 'compras:compras_list' %}" class="btn btn-secondary">Volver</a>
  <a href="{% url 'compras:compras_edit' compra.pk %}" class="btn btn-warning">Editar</a>
</div>
{% endblock %}
